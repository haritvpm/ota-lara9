(()=>{var e;function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var s=o.call(e,t||"default");if("object"!==r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}new Vue({el:"#app",data:{isProcessing:!1,form:{},errors:{},myerrors:[],pen_names:[]},created:function(){Vue.set(this.$data,"form",_form),this.sessionchanged()},mounted:function(){},computed:{configdate:function(){return{format:"DD-MM-YYYY"}},isActive:function(){}},watch:{},methods:(e={sessionchanged:function(){null!=calenderdays2[this.form.session]?(this.form.date_from=calenderdays2[this.form.session][0],this.form.date_to=calenderdays2[this.form.session][calenderdays2[this.form.session].length-1]):(this.form.date_from="",this.form.date_to="")},onChange:function(){this.myerrors=[],this.slotoptions=this.slotoptions,this.selectdaylabel=": "+calenderdaysmap[this.form.duty_date],this.form.overtime_slot=""},addRow:function(){var e=this;if(this.rowsvalid()){var r=e.form.overtimes.length>0?e.form.overtimes[e.form.overtimes.length-1]:null;e.form.overtimes.push({pen:"",from:r?r.from:e.form.date_from,to:r?r.to:e.form.date_to,count:"",worknature:""}),this.pen_names=[],this.$nextTick((function(){e.$refs["field-"+(e.form.overtimes.length-1)][0].$el.focus()}))}},removeElement:function(e){this.form.overtimes.splice(e,1),this.myerrors=[]},limitText:function(e){return"and ".concat(e," more")},asyncFind:_.debounce((function(e){this.mydelayedsearch(e),this.myerrors=[]}),500),mydelayedsearch:function(e){var r=this;e.length>=3&&axios.get(urlajaxpen+"/"+e).then((function(e){r.pen_names=e.data})).catch((function(e){alert(JSON.stringify(e.data))}))},clearAll:function(){this.pen_names=[]}},t(e,"limitText",(function(e){return"and ".concat(e," other countries")})),t(e,"changeSelect",(function(e){this.myerrors=[]})),t(e,"checkDuplicates",(function(){for(var e=this,r={},t=0;t<e.form.overtimes.length;t++){if(null!=r[e.form.overtimes[t].pen])return this.myerrors.push("Duplicate name found: "+e.form.overtimes[t].pen),!1;r[e.form.overtimes[t].pen]=!0}return!0})),t(e,"rowsvalid",(function(){this.myerrors=[];var e=this;if(""==e.form.session||""==e.form.date_from||""==e.form.date_to)return this.$swal("Oops","Please select session/dates!","error"),!1;if(null==calenderdays2[e.form.session])return this.$swal("Oops","Session calender not valid","error"),!1;if(-1==calenderdays2[e.form.session].indexOf(e.form.date_from)||-1==calenderdays2[e.form.session].indexOf(e.form.date_to))return this.$swal("Oops","Please select a valid from-date/to-date for the selected session","error"),!1;var r=e.form.date_from.split("-").map(Number),t=e.form.date_to.split("-").map(Number);if(new Date(r[2],r[1]-1,r[0])>new Date(t[2],t[1]-1,t[0]))return this.$swal("Oops","Date-from cannot be greater than Date-to!","error"),!1;if(e.form.overtimes.some((function(e){return""==e.pen||""==e.from||""==e.to||null==e.from||null==e.to||+e.count<=0||isNaN(+e.count)})))return this.$swal("Oops","Fill all the required fields in each row!","error"),!1;var o=calenderdays2[this.form.session].length;if(e.form.overtimes.some((function(e){return+e.count>o})))return this.myerrors.push("Total sitting days cannot be more than "+o),!1;for(var s=0;s<e.form.overtimes.length;s++){r=e.form.overtimes[s].from.split("-").map(Number),t=e.form.overtimes[s].to.split("-").map(Number);if(new Date(r[2],r[1]-1,r[0])>new Date(t[2],t[1]-1,t[0]))return this.myerrors.push("Row "+(s+1)+": Period-from cannot be greater than period-to"),!1}return this.checkDuplicates()})),t(e,"create",(function(){if(!this.isProcessing)if(this.isProcessing=!0,this.rowsvalid()){var e=this;if(e.form.overtimes.length<=0)return this.$swal("Oops","Need at least one row!","error"),this.isProcessing=!1,!1;axios.post(urlformsubmit,e.form).then((function(r){r.data.created?window.location.href=urlformsucessredirect+"/"+r.data.id:e.isProcessing=!1})).catch((function(r){e.$swal({type:"error",title:"Error",text:"Please read the error(s) shown in red at the top",timer:2500});var t=r.response;e.isProcessing=!1,e.errors=t.data}))}else this.isProcessing=!1})),t(e,"update",(function(){if(!this.isProcessing)if(this.isProcessing=!0,this.rowsvalid()){var e=this;if(e.form.overtimes.length<=0)return this.$swal("Oops","Need at least one row!","error"),this.isProcessing=!1,!1;this.isProcessing=!0;var r=urlformsubmit+"/"+e.form.id;axios.put(r,e.form).then((function(r){r.data.created?window.location.href=urlformsucessredirect+"/"+r.data.id:e.isProcessing=!1})).catch((function(r){e.$swal({type:"error",title:"Error",text:"Please read the error(s) shown in red at the top",timer:2500});var t=r.response;e.isProcessing=!1,e.errors=t.data}))}else this.isProcessing=!1})),t(e,"loadall",(function(){var e=this,r=e.form.overtimes.length>0?e.form.overtimes[e.form.overtimes.length-1]:null;axios.get(urlajaxpresets+"/all").then((function(t){for(var o=t.data,s=0;s<o.length;s++){for(var i=o[s],n=!1,a=0;a<e.form.overtimes.length;a++){if(e.form.overtimes[a].pen==i){n=!0;break}}n||e.form.overtimes.push({pen:i,from:r?r.from:e.form.date_from,to:r?r.to:e.form.date_to,count:"",worknature:""})}})).catch((function(e){}))})),e)})})();