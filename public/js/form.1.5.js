(()=>{"use strict";var e;function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,r,o){return(r=function(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,r||"default");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===t(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function o(e){return moment(e,["HH:mm","h:mm A"]).format("HH:mm")}var i=new Vue({el:"#app",data:{selectdaylabel:"",isProcessing:!1,form:{},errors:{},myerrors:[],pen_names:[],pen_names_to_desig:[],presets,presets_default,configtime:{format:"HH:mm",stepping:15}},created:function(){Vue.set(this.$data,"form",_form);var e=this;this.$watch("form.duty_date",(function(t,r){e.onChange()})),autoloadpens&&this.loadpresetdata(autoloadpens)},mounted:function(){},computed:{configdate:function(){return{format:"DD-MM-YYYY",useCurrent:!1,enabledDates:Object.keys(calenderdaysmap).map((function(e){return moment(e,"DD-MM-YYYY").format("YYYY-MM-DD")}))}},isActive:function(){},slotoptions:function(){if(0==this.form.duty_date.length)return"";if(ispartimefulltime||iswatchnward)return["First","Second"];switch(calenderdaysmap[this.form.duty_date]){case"Sitting day":return["First","Second","Third"];case"Prior holiday":case"Holiday":return["First","Second","Third","Additional"];case void 0:return"";default:return["First","Second","Third"]}}},watch:{},methods:(e={copytimedown:function(){if(this.form.overtimes.length>1)for(var e=1;e<this.form.overtimes.length;e++)this.form.overtimes[e].from=this.form.overtimes[0].from,this.form.overtimes[e].to=this.form.overtimes[0].to},copyworknaturedown:function(){if(this.form.overtimes.length>1)for(var e=1;e<this.form.overtimes.length;e++)this.form.overtimes[e].worknature=this.form.overtimes[0].worknature},sessionchanged:function(){this.myerrors=[],""!=this.form.duty_date&&null!=this.form.duty_date&&-1==calenderdays2[this.form.session].indexOf(this.form.duty_date)&&this.myerrors.push("For session "+this.form.session+", please select a date between : "+calenderdays2[this.form.session][0]+" and "+calenderdays2[this.form.session][calenderdays2[this.form.session].length-1]+".")},onChange:function(){this.myerrors=[],this.slotoptions=this.slotoptions,this.form.overtime_slot="",""!=this.form.duty_date&&null!=this.form.duty_date&&(void 0!==calenderdaysmap[this.form.duty_date]?this.selectdaylabel=": "+calenderdaysmap[this.form.duty_date]:this.selectdaylabel=": Not valid for the session",-1==calenderdays2[this.form.session].indexOf(this.form.duty_date)&&this.myerrors.push("For session "+this.form.session+", please select a date between : "+calenderdays2[this.form.session][0]+" and "+calenderdays2[this.form.session][calenderdays2[this.form.session].length-1]+"."))},onChangeSlot:function(){if(this.myerrors=[],this.form.overtimes.length>0&&""==this.form.overtimes[0].from)for(var e=0;e<this.form.overtimes.length;e++)this.form.overtimes[e].from="",this.form.overtimes[e].to=""},getDefaultTimes:function(e,t){var r=this.getDayTypes(),o=r.isSittingDay,i=(r.isSittingOrWorkingDay,r.isWorkingDay),s=r.isHoliDay,n="",a="";if(t.isPartime)switch(e){case"First":o?(n="06:00",a="11:30"):i&&(n="11:00",a="13:30");break;case"Second":o&&(n="14:00",a="16:30")}else if(t.isFulltime){if("First"===e)o?(n="06:00",a="16:30"):i&&(n="08:00",a="17:00")}else t.isWatchnward||(n="17:30",a="20:00","First"==e?o?(n="8:00",a="17:30"):i?(n="10:15",a="19:45",presets_default&&presets_default.hasOwnProperty("default_workingday_firstot_starttime")&&presets_default.hasOwnProperty("default_workingday_firstot_endtime")&&(n=presets_default.default_workingday_firstot_starttime,a=presets_default.default_workingday_firstot_endtime)):(n="14:30",a="17:30",presets_default&&presets_default.hasOwnProperty("default_holiday_firstot_starttime")&&presets_default.hasOwnProperty("default_holiday_firstot_endtime")&&(n=presets_default.default_holiday_firstot_starttime,a=presets_default.default_holiday_firstot_endtime)):"Second"==e?o?(n="17:30",a="20:00",presets_default&&presets_default.hasOwnProperty("default_sittingday_secondot_starttime")&&presets_default.hasOwnProperty("default_sittingday_secondot_endtime")&&(n=presets_default.default_sittingday_secondot_starttime,a=presets_default.default_sittingday_secondot_endtime)):i?(n="19:45",a="22:15",presets_default&&presets_default.hasOwnProperty("default_workingday_secondot_starttime")&&presets_default.hasOwnProperty("default_workingday_secondot_endtime")&&(n=presets_default.default_workingday_secondot_starttime,a=presets_default.default_workingday_secondot_endtime)):s&&(n="17:30",a="20:30",presets_default&&presets_default.hasOwnProperty("default_holiday_secondot_starttime")&&presets_default.hasOwnProperty("default_holiday_secondot_endtime")&&(n=presets_default.default_holiday_secondot_starttime,a=presets_default.default_holiday_secondot_endtime)):"Third"==e?(n="20:30",a="23:30",o?(n="20:00",a="22:30"):i&&(n="22:15",a="00:45")):"Additional"==e&&(n="10:30",a="13:30"));return{def_time_start:n,def_time_end:a}},addRow:function(){this.insertElement(this.form.overtimes.length)},insertElement:function(e){var t=this;if(this.rowsvalid()){this.myerrors=[];var r=e>0&&t.form.overtimes.length>=e?t.form.overtimes[e-1]:null;this.form.overtimes.splice(e,0,{pen:"",designation:"",from:r?r.from:"",to:r?r.to:"",punching:!0,punching_id:null}),this.pen_names=[],this.pen_names_to_desig=[],this.$nextTick((function(){t.$refs["field-"+e][0].$el.focus()}))}},removeElement:function(e){this.form.overtimes.splice(e,1),this.myerrors=[]},limitText:function(e){return"and ".concat(e," more")},asyncFind:_.debounce((function(e){this.mydelayedsearch(e),this.myerrors=[]}),500),mydelayedsearch:function(e){var t=this;e.length>=3&&axios.get(urlajaxpen+"/"+e).then((function(e){t.pen_names=e.data.pen_names,t.pen_names_to_desig=e.data.pen_names_to_desig})).catch((function(e){}))},clearAll:function(){this.pen_names=[],this.pen_names_to_desig=[]}},r(e,"limitText",(function(e){return"and ".concat(e," other ")})),r(e,"setEmployeeTypes",(function(e){e.isPartime=-1!=e.designation.toLowerCase().indexOf("part time"),e.isFulltime=-1!=e.category.toLowerCase().indexOf("fulltime"),e.isWatchnward=-1!=e.category.toLowerCase().indexOf("watch")})),r(e,"changeSelect",(function(e,t){var r=this;this.myerrors=[];var o=this,i=o.pen_names_to_desig[e];o.$nextTick((function(){var e=o.form.overtimes[t];if(e.punching=!0,e.normal_office_hours=0,e.category="",void 0!==i&&i.desig&&(e.designation=i.desig,e.punching=i.punching,e.normal_office_hours=i.desig_normal_office_hours,e.category=i.category,e.employee_id=i.employee_id,r.setEmployeeTypes(e),console.log(e),0==t)){var s=r.getDefaultTimes(r.form.overtime_slot,e),n=s.def_time_start,a=s.def_time_end;e.from=n,e.to=a}o.form.overtimes[t].punchin="",o.form.overtimes[t].punchout="",o.form.overtimes[t].punching_id=null,void 0!==i&&o.form.overtimes[t].punching&&axios.get(urlajaxgetpunchtimes+"/"+o.form.duty_date+"/"+o.form.overtimes[t].pen).then((function(e){console.log("got punch data"),console.log(e),e.data&&e.data.hasOwnProperty("punchin")&&e.data.hasOwnProperty("punchout")&&(o.form.overtimes[t].punchin=e.data.punchin,o.form.overtimes[t].punchout=e.data.punchout,o.form.overtimes[t].punching_id=e.data.id)})).catch((function(e){}))}))})),r(e,"updateSelect",(function(e,t){})),r(e,"checkDuplicates",(function(){for(var e=this,t={},r=0;r<e.form.overtimes.length;r++){if(null!=t[e.form.overtimes[r].pen])return this.myerrors.push("Duplicate name found: "+e.form.overtimes[r].pen),!1;t[e.form.overtimes[r].pen]=!0}return!0})),r(e,"stringTimeToDate",(function(e){var t=e.split(":").map(Number);return Date.UTC(2e3,1,1,t[0],t[1])})),r(e,"checkTimeWithinPunchingTime",(function(e){if(!e.punching)return!0;var t=this.stringTimeToDate(e.from),r=this.stringTimeToDate(e.to);r<=t&&(r+=864e5);var o=this.stringTimeToDate(e.punchin),i=this.stringTimeToDate(e.punchout);return i<=o&&(i+=864e5),!(o>t||i<r)})),r(e,"checkTimeIsAsPerGOOnSittingDay",(function(e,t,r){if(t.isPartime){if("First"==e){if("06:00"!=t.from||"11:30"!=t.to)return this.myerrors.push("Row "+(r+1)+": Parttime employee - time shall be 06:00 to 11:30 as per G.O on a sitting day"),!1}else if("Second"==e&&("14:00"!=t.from||"16:30"!=t.to))return this.myerrors.push("Row "+(r+1)+": Parttime employee - time shall be 14:00 to 16:30 as per G.O on a sitting day"),!1}else if(t.isFulltime){if("First"==e&&"06:00"!=t.from)return this.myerrors.push("Row "+(r+1)+": Fulltime employee - time shall be from 06:00 a.m. as per G.O on a sitting day"),!1}else if(t.isWatchnward);else if("First"==e&&("08:00"!=t.from||"17:30"!=t.to)||"Second"==e&&"17:30"!=t.from||"Third"==e&&"20:00"!=t.from)return this.myerrors.push("Row "+(r+1)+": Time should be as per G.O on a sitting day"),!1;return!0})),r(e,"checkIfOTOverlapsWithOfficeHours",(function(e,t,r,o,i){if("First"===e)return!0;var s=o.split(":").map(Number),n=i.split(":").map(Number),a=Date.UTC(2e3,1,1,s[0],s[1]),m=Date.UTC(2e3,1,1,n[0],n[1]);return!(a<r&&m>t||a==t||m==r)})),r(e,"getDayTypes",(function(){return{isSittingDay:"Sitting day"==calenderdaysmap[this.form.duty_date],isSittingOrWorkingDay:-1==calenderdaysmap[this.form.duty_date].indexOf("oliday"),isWorkingDay:-1!=calenderdaysmap[this.form.duty_date].indexOf("orking"),isHoliDay:-1!=calenderdaysmap[this.form.duty_date].indexOf("oliday")}})),r(e,"rowsvalid",(function(){this.myerrors=[];var e=this;if(""==e.form.session||""==e.form.duty_date||""==e.form.overtime_slot)return this.$swal("Error","Please select session/date/OT","error"),!1;if(-1==calenderdays2[e.form.session].indexOf(e.form.duty_date))return this.$swal("Error","The duty date is not a calender date for the session: "+e.form.session,"error"),!1;for(var t=0;t<e.form.overtimes.length;t++){if(""==(d=e.form.overtimes[t]).pen||""==d.designation||""==d.from||""==d.to||null==d.from||null==d.to)return this.$swal("Row: "+(t+1),"Fill all the fields in every row","error"),!1;if(e.form.overtimes[t].punching&&d.punching&&(null==d.punchin||""==d.punchin||null==d.punchout||""==d.punchout))return this.$swal("Row: "+(t+1),"Fill punch in/out time for every row","error"),!1}if("Additional"==e.form.overtime_slot&&e.form.overtimes.some((function(e){return"Deputy Secretary"!=e.designation&&"Joint Secretary"!=e.designation&&"Additional Secretary"!=e.designation&&"Special Secretary"!=e.designation})))return this.$swal("Error","Only DS or above can have Additional OT!","error"),!1;var r=this.getDayTypes(),i=r.isSittingDay,s=r.isSittingOrWorkingDay,n=r.isWorkingDay,a=(r.isHoliDay,e.form.overtime_slot),m=parseFloat(3),f="holiday";s&&(m=2.5,f="working day",i&&(f="sitting day"));for(t=0;t<e.form.overtimes.length;t++){var d=e.form.overtimes[t];if(console.log(d),this.setEmployeeTypes(d),d.punching&&(d.punchin=o(d.punchin.trim()),d.punchout=o(d.punchout.trim())),d.from=o(d.from.trim()),d.to=o(d.to.trim()),"invalid date"==d.from.toLowerCase()||"invalid date"==d.to.toLowerCase())return d.from=d.to="",this.myerrors.push("Row "+(t+1)+": Invalid time format. Enter (HH:MM) in 24 hour format ( examples: 09:30, 17:30)."),!1;if(!this.checkTimeWithinPunchingTime(d))return this.myerrors.push("Row "+(t+1)+": OT period should be within punching times"),!1;if(i&&!this.checkTimeIsAsPerGOOnSittingDay(a,d,t))return!1;var u=this.stringTimeToDate(d.from),l=this.stringTimeToDate(d.to);l<=u&&(l+=864e5);var h=parseFloat((l-u)/36e5);if(h<m)return this.myerrors.push("Row "+(t+1)+": At least "+m+" hours needed for OT on a "+f),!1;if(s){var c=2.5+d.normal_office_hours;if("First"==a&&h<c)return this.myerrors.push("Row  ".concat(t+1," : At least ").concat(c," hours needed for First OT on a ").concat(f)),!1}if(d.isPartime)if(i){if("Third"===a)return this.myerrors.push("Row "+(t+1)+": Parttime employees cannot have third OT on sitting day"),!1}else if(n&&"First"!==a)return this.myerrors.push("Row "+(t+1)+": Parttime employees cannot have second/third OT on working day"),!1;if(d.isFulltime&&s&&"First"!==a)return this.myerrors.push("Row "+(t+1)+": FullTime employees cannot have second/third OT on working/sitting day"),!1;if(!(d.isPartime||d.isFulltime||d.isWatchnward||isspeakeroffice)&&(i||n)&&"First"!==a){var p="10:15",y="17:15";if(i&&(p="08:00",y="17:30"),!this.checkIfOTOverlapsWithOfficeHours(a,u,l,p,y))return this.myerrors.push("Row ".concat(t+1," : OT cannot be between ").concat(p," and ").concat(y," am on a ").concat(f)),!1}}return this.checkDuplicates()})),r(e,"create",(function(){if(!this.isProcessing){if(this.isProcessing=!0,this.rowsvalid()){var e=this;return e.form.overtimes.length<=0?(this.$swal("Error","Need at least one row!","error"),this.isProcessing=!1,!1):""==e.form.worknature?(this.$swal("Error","Please enter the nature of work done","error"),this.isProcessing=!1,!1):void axios.post(urlformsubmit,e.form).then((function(t){t.data.created?window.location.href=urlformsucessredirect+"/"+t.data.id:e.isProcessing=!1})).catch((function(t){e.$swal({type:"error",title:"Error",text:"Please see the error(s) shown in red at the top",timer:2500});var r=t.response;e.isProcessing=!1,e.errors=r.data}))}this.isProcessing=!1}})),r(e,"update",(function(){if(!this.isProcessing)if(this.isProcessing=!0,this.rowsvalid()){var e=this;if(e.form.overtimes.length<=0)return this.$swal("Error","Need at least one row!","error"),this.isProcessing=!1,!1;if(""==e.form.worknature)return this.$swal("Error","Please enter the nature of work done","error"),this.isProcessing=!1,!1;var t=urlformsubmit+"/"+e.form.id;axios.put(t,e.form).then((function(t){t.data.created?window.location.href=urlformsucessredirect+"/"+t.data.id:e.isProcessing=!1})).catch((function(t){e.$swal({type:"error",title:"Error",text:"Please read the error(s) shown in red at the top",timer:2500});var r=t.response;e.isProcessing=!1,e.errors=r.data}))}else this.isProcessing=!1})),r(e,"savepreset",(function(){for(var e=this,t=[],r=0;r<e.form.overtimes.length;r++){var o=e.form.overtimes[r].pen;""!=o&&t.push(o)}if(0!=t.length){var i={};i.pens=t,i.name="default",e.$swal({text:"Enter a name for preset",input:"text",inputValue:"",showCancelButton:!0,showLoaderOnConfirm:!0,useRejections:!0,inputValidator:function(e){return new Promise((function(t,r){e?presets.indexOf(e)>-1?r("Preset with same name exists!"):t():r("You need to write something!")}))},preConfirm:function(e){return new Promise((function(t,r){i.name=e,axios.post(urlpresetsubmit,i).then((function(e){1==e.data.result?t():r(e.data.error)})).catch((function(e){r(e.response.data)}))}))}}).then((function(t){e.$swal({type:"success",html:"Saved!",timer:1500,useRejections:!1})}))}else e.$swal("","No rows to save","error")})),r(e,"loadpreset",(function(){var e=this;0!=presets.length?e.$swal({text:"Load Preset",input:"select",inputOptions:presets,inputPlaceholder:"Select preset",showCancelButton:!0,useRejections:!1,inputValidator:function(e){return new Promise((function(t,r){e?t():r("You need to select something)")}))},showLoaderOnConfirm:!0,preConfirm:function(t){return new Promise((function(r,o){axios.get(urlajaxpresets+"/"+presets[t]).then((function(t){e.loadpresetdata(t.data),r()})).catch((function(e){o(e.response.data)}))}))}}).then((function(e){})):e.$swal("Sorry, no presets to load. Save a preset first")})),r(e,"loadpresetdata",(function(e){var t=this,r="",o="",i=t.presets_default.default_worknature;for(var s in""!=this.form.overtime_slot&&(r="17:30",o="20:30"),t.form.overtimes.length>0&&(r=t.form.overtimes[0].from,o=t.form.overtimes[0].to,i=t.form.overtimes[0].worknature),e)if(e.hasOwnProperty(s)){for(var n=!1,a=0;a<t.form.overtimes.length;a++){if(t.form.overtimes[a].pen==s){n=!0;break}}n||t.form.overtimes.push({pen:s,designation:e[s].desig,from:r,to:o,worknature:i,category:e[s].category,employee_id:e[s].employee_id,punching:e[s].punching,normal_office_hours:e[s].normal_office_hours})}})),r(e,"copytimedownonerow",(function(){console.log("copytimedownonerow");for(var e=0;e<this.form.overtimes.length-1;e++)if(""!=this.form.overtimes[e].from&&""!=this.form.overtimes[e].to&&""==this.form.overtimes[e+1].from&&""==this.form.overtimes[e+1].to){this.form.overtimes[e+1].from=this.form.overtimes[e].from,this.form.overtimes[e+1].to=this.form.overtimes[e].to;break}})),e)});window.addEventListener("keydown",(function(e){if(!e.defaultPrevented){var t=!1;void 0!==e.key?"F4"==e.key?(i.copytimedownonerow(),t=!0):"`"==e.key&&(i.addRow(),t=!0):void 0!==e.keyIdentifier||e.keyCode,t&&e.preventDefault()}}),!0)})();