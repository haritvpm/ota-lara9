!function(e){function t(o){if(r[o])return r[o].exports;var s=r[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=35)}({35:function(e,t,r){e.exports=r(36)},36:function(e,t){function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){return moment(e,["HH:mm","h:mm A"]).format("HH:mm")}var s,i="17:30",n="20:30";new Vue({el:"#app",data:{selectdaylabel:"",isProcessing:!1,form:{},errors:{},myerrors:[],muloptions:designations,pen_names:[],pen_names_to_desig:[],presets:presets,presets_default:presets_default,configtime:{format:"HH:mm",stepping:15}},created:function(){Vue.set(this.$data,"form",_form);var e=this;this.$watch("form.duty_date",function(t,r){e.onChange()}),autoloadpens&&this.loadpresetdata(autoloadpens)},mounted:function(){},computed:{configdate:function(){return{format:"DD-MM-YYYY",useCurrent:!1,enabledDates:Object.keys(calenderdaysmap).map(function(e){return moment(e,"DD-MM-YYYY").format("YYYY-MM-DD")})}},isActive:function(){},slotoptions:function(){if(0==this.form.duty_date.length)return"";if(ispartimefulltime)switch(calenderdaysmap[this.form.duty_date]){case"Sitting day":return["Second"];default:return["First","Second"]}else switch(calenderdaysmap[this.form.duty_date]){case"Sitting day":return["Second","Third"];case"Prior holiday":case"Holiday":return["First","Second","Third","Additional"];case void 0:return"";default:return["First","Second","Third"]}}},watch:{},methods:(s={copytimedown:function(){if(this.form.overtimes.length>1)for(var e=1;e<this.form.overtimes.length;e++)this.form.overtimes[e].from=this.form.overtimes[0].from,this.form.overtimes[e].to=this.form.overtimes[0].to},copyworknaturedown:function(){if(this.form.overtimes.length>1)for(var e=1;e<this.form.overtimes.length;e++)this.form.overtimes[e].worknature=this.form.overtimes[0].worknature},sessionchanged:function(){this.myerrors=[],""!=this.form.duty_date&&null!=this.form.duty_date&&-1==calenderdays2[this.form.session].indexOf(this.form.duty_date)&&this.myerrors.push("For session "+this.form.session+", please select a date between : "+calenderdays2[this.form.session][0]+" and "+calenderdays2[this.form.session][calenderdays2[this.form.session].length-1]+".")},onChange:function(){this.myerrors=[],this.slotoptions=this.slotoptions,this.form.overtime_slot="",""!=this.form.duty_date&&null!=this.form.duty_date&&(void 0!==calenderdaysmap[this.form.duty_date]?this.selectdaylabel=": "+calenderdaysmap[this.form.duty_date]:this.selectdaylabel=": Not valid for the session",-1==calenderdays2[this.form.session].indexOf(this.form.duty_date)&&this.myerrors.push("For session "+this.form.session+", please select a date between : "+calenderdays2[this.form.session][0]+" and "+calenderdays2[this.form.session][calenderdays2[this.form.session].length-1]+"."))},onChangeSlot:function(){this.myerrors=[];var e=calenderdaysmap[this.form.duty_date];if(void 0!==e&&(e=e.toLowerCase()),i="17:30",n="20:00","First"==this.form.overtime_slot?void 0!==e&&-1==e.indexOf("holiday")?(i="09:30",n="19:00",presets_default&&presets_default.hasOwnProperty("default_workingday_firstot_starttime")&&presets_default.hasOwnProperty("default_workingday_firstot_endtime")&&(i=presets_default.default_workingday_firstot_starttime,n=presets_default.default_workingday_firstot_endtime)):(i="14:30",n="17:30",presets_default&&presets_default.hasOwnProperty("default_holiday_firstot_starttime")&&presets_default.hasOwnProperty("default_holiday_firstot_endtime")&&(i=presets_default.default_holiday_firstot_starttime,n=presets_default.default_holiday_firstot_endtime)):"Second"==this.form.overtime_slot?void 0!==e&&-1!=e.indexOf("sitting")?(i="17:30",n="20:00",presets_default&&presets_default.hasOwnProperty("default_sittingday_secondot_starttime")&&presets_default.hasOwnProperty("default_sittingday_secondot_endtime")&&(i=presets_default.default_sittingday_secondot_starttime,n=presets_default.default_sittingday_secondot_endtime)):void 0!==e&&-1==e.indexOf("holiday")?(i="20:00",n="22:30",presets_default&&presets_default.hasOwnProperty("default_workingday_secondot_starttime")&&presets_default.hasOwnProperty("default_workingday_secondot_endtime")&&(i=presets_default.default_workingday_secondot_starttime,n=presets_default.default_workingday_secondot_endtime)):void 0!==e&&-1!=e.indexOf("holiday")&&(i="17:30",n="20:30",presets_default&&presets_default.hasOwnProperty("default_holiday_secondot_starttime")&&presets_default.hasOwnProperty("default_holiday_secondot_endtime")&&(i=presets_default.default_holiday_secondot_starttime,n=presets_default.default_holiday_secondot_endtime)):"Third"==this.form.overtime_slot?(i="20:30",n="23:30",void 0!==e&&-1==e.indexOf("holiday")&&(i="20:00",n="22:30")):"Additional"==this.form.overtime_slot&&(i="10:30",n="13:30"),this.form.overtimes.length>0){for(var t=0;t<this.form.overtimes.length;t++)this.form.overtimes[t].from="",this.form.overtimes[t].to="";this.form.overtimes[0].from=i,this.form.overtimes[0].to=n}},addRow:function(){this.insertElement(this.form.overtimes.length)},insertElement:function(e){var t=this;if(this.rowsvalid()){this.myerrors=[];var r=e>0&&t.form.overtimes.length>=e?t.form.overtimes[e-1]:null;this.form.overtimes.splice(e,0,{pen:"",designation:"",from:r?r.from:i,to:r?r.to:n,worknature:r?r.worknature:presets_default.default_worknature}),this.pen_names=[],this.pen_names_to_desig=[],this.$nextTick(function(){t.$refs["field-"+e][0].$el.focus()})}},removeElement:function(e){this.myerrors=[],this.form.overtimes.splice(e,1)},limitText:function(e){return"and "+e+" more"},asyncFind:_.debounce(function(e){this.mydelayedsearch(e),this.myerrors=[]},500),mydelayedsearch:function(e){var t=this;e.length>=3&&axios.get(urlajaxpen+"/"+e).then(function(e){t.pen_names=e.data.pen_names,t.pen_names_to_desig=e.data.pen_names_to_desig}).catch(function(e){})},clearAll:function(){this.pen_names=[],this.pen_names_to_desig=[]}},r(s,"limitText",function(e){return"and "+e+" other countries"}),r(s,"changeSelect",function(e,t){this.myerrors=[];var r=this;r.$nextTick(function(){for(var t=0;t<r.form.overtimes.length;t++)if(r.form.overtimes[t].pen==e){var o=r.pen_names_to_desig[e];void 0!==o&&(r.form.overtimes[t].designation=o);break}})}),r(s,"updateSelect",function(e,t){}),r(s,"checkDuplicates",function(){for(var e=this,t={},r=0;r<e.form.overtimes.length;r++){if(void 0!=t[e.form.overtimes[r].pen])return this.myerrors.push("Duplicate name found: "+e.form.overtimes[r].pen),!1;t[e.form.overtimes[r].pen]=!0}return!0}),r(s,"rowsvalid",function(){this.myerrors=[];var e=this;if(""==e.form.session||""==e.form.duty_date||""==e.form.overtime_slot)return this.$swal("Oops","Please select session/date/OT","error"),!1;if(-1==calenderdays2[e.form.session].indexOf(e.form.duty_date))return this.$swal("Oops","The duty date is not within the range of dates for the session: "+e.form.session,"error"),!1;for(var t=0;t<e.form.overtimes.length;t++){var r=e.form.overtimes[t];if(""==r.pen||""==r.designation||""==r.from||""==r.to||null==r.from||null==r.to||null==r.worknature||""==r.worknature)return this.$swal("Row: "+(t+1),"Fill all the fields in every row","error"),!1}if("Additional"==e.form.overtime_slot&&e.form.overtimes.some(function(e){return"Deputy Secretary"!=e.designation&&"Joint Secretary"!=e.designation&&"Additional Secretary"!=e.designation&&"Special Secretary"!=e.designation}))return this.$swal("Oops","Only DS or above can have Additional OT!","error"),!1;for(var t=0;t<e.form.overtimes.length;t++){if(e.form.overtimes[t].from=e.form.overtimes[t].from.trim(),e.form.overtimes[t].to=e.form.overtimes[t].to.trim(),e.form.overtimes[t].from=o(e.form.overtimes[t].from),e.form.overtimes[t].to=o(e.form.overtimes[t].to),"invalid date"==e.form.overtimes[t].from.toLowerCase()||"invalid date"==e.form.overtimes[t].to.toLowerCase())return e.form.overtimes[t].from=e.form.overtimes[t].to="",this.myerrors.push("Row "+(t+1)+": Invalid time format. Enter (HH:MM) in 24 hour format ( examples: 09:30, 17:30)."),!1;if(!iswatchnward&&"Sitting day"==calenderdaysmap[this.form.duty_date])if(-1!=e.form.overtimes[t].designation.toLowerCase().indexOf("part time")){if("Second"!=e.form.overtime_slot)return this.myerrors.push("Row "+(t+1)+": Parttime employees cannot have third OT on a sitting day"),!1;if("14:00"!=e.form.overtimes[t].from||"16:30"!=e.form.overtimes[t].to)return this.myerrors.push("Row "+(t+1)+": Parttime employees time should be as per G.O on a sitting day"),!1}else if("Second"==e.form.overtime_slot&&"17:30"!=e.form.overtimes[t].from||"Third"==e.form.overtime_slot&&"20:00"!=e.form.overtimes[t].from)return this.myerrors.push("Row "+(t+1)+": Time should be as per G.O on a sitting day"),!1;var s=e.form.overtimes[t].from.split(":").map(Number),i=e.form.overtimes[t].to.split(":").map(Number),n=Date.UTC(2e3,1,1,s[0],s[1]),a=Date.UTC(2e3,1,1,i[0],i[1]);a<=n&&(a+=864e5);var d=(a-n)/36e5,f=3,m="holiday";if(-1==calenderdaysmap[this.form.duty_date].indexOf("oliday")&&(f=2.5,m="sitting/working day"),d<f)return this.myerrors.push("Row "+(t+1)+": At least "+f+" hours needed for OT on a "+m),!1;if(!ispartimefulltime&&!iswatchnward&&!isspeakeroffice)if("Sitting day"==calenderdaysmap[this.form.duty_date]){var l=Date.UTC(2e3,1,1,"08","00"),u=Date.UTC(2e3,1,1,"10","30"),h=l<a&&u>n||l==n||u==a;if(h)return this.myerrors.push("Row "+(t+1)+": OT cannot be between 8:00 am and 10:30 am on a Sitting day"),!1}else if(-1==calenderdaysmap[this.form.duty_date].indexOf("oliday")){var l=Date.UTC(2e3,1,1,"10","15"),u=Date.UTC(2e3,1,1,"17","15"),h=l<a&&u>n||l==n||u==a;if(h&&d<9.5)return this.myerrors.push("Row "+(t+1)+": Warning - at least 2.5 hours needed for OT on a working day"),!1}}return this.checkDuplicates()}),r(s,"create",function(){if(!this.isProcessing){if(this.isProcessing=!0,!this.rowsvalid())return void(this.isProcessing=!1);var e=this;if(e.form.overtimes.length<=0)return this.$swal("Oops","Need at least one row!","error"),this.isProcessing=!1,!1;axios.post(urlformsubmit,e.form).then(function(t){t.data.created?window.location.href=urlformsucessredirect+"/"+t.data.id:e.isProcessing=!1}).catch(function(t){e.$swal({type:"error",title:"Error",text:"Please read the error(s) shown in red at the top",timer:2500});var r=t.response;e.isProcessing=!1,e.errors=r.data})}}),r(s,"update",function(){if(!this.isProcessing){if(this.isProcessing=!0,!this.rowsvalid())return void(this.isProcessing=!1);var e=this;if(e.form.overtimes.length<=0)return this.$swal("Oops","Need at least one row!","error"),this.isProcessing=!1,!1;var t=urlformsubmit+"/"+e.form.id;axios.put(t,e.form).then(function(t){t.data.created?window.location.href=urlformsucessredirect+"/"+t.data.id:e.isProcessing=!1}).catch(function(t){e.$swal({type:"error",title:"Error",text:"Please read the error(s) shown in red at the top",timer:2500});var r=t.response;e.isProcessing=!1,e.errors=r.data})}}),r(s,"savepreset",function(){for(var e=this,t=[],r=0;r<e.form.overtimes.length;r++){var o=e.form.overtimes[r].pen;""!=o&&t.push(o)}if(0==t.length)return void e.$swal("","No rows to save","error");var s={};s.pens=t,s.name="default",e.$swal({text:"Enter a name for preset",input:"text",inputValue:"",showCancelButton:!0,showLoaderOnConfirm:!0,useRejections:!0,inputValidator:function(e){return new Promise(function(t,r){if(e){presets.indexOf(e)>-1?r("Preset with same name exists!"):t()}else r("You need to write something!")})},preConfirm:function(e){return new Promise(function(t,r){s.name=e,axios.post(urlpresetsubmit,s).then(function(e){1==e.data.result?t():r(e.data.error)}).catch(function(e){r(e.response.data)})})}}).then(function(t){e.$swal({type:"success",html:"Saved!",timer:1500,useRejections:!1})})}),r(s,"loadpreset",function(){var e=this;if(0==presets.length)return void e.$swal("Sorry, no presets to load. Save a preset first");e.$swal({text:"Load Preset",input:"select",inputOptions:presets,inputPlaceholder:"Select preset",showCancelButton:!0,useRejections:!1,inputValidator:function(e){return new Promise(function(t,r){e?t():r("You need to select something)")})},showLoaderOnConfirm:!0,preConfirm:function(t){return new Promise(function(r,o){axios.get(urlajaxpresets+"/"+presets[t]).then(function(t){e.loadpresetdata(t.data),r()}).catch(function(e){o(e.response.data)})})}}).then(function(e){})}),r(s,"loadpresetdata",function(e){var t=this,r="",o="",s=t.presets_default.default_worknature;""!=this.form.overtime_slot&&(r=i,o=n),t.form.overtimes.length>0&&(r=t.form.overtimes[0].from,o=t.form.overtimes[0].to,s=t.form.overtimes[0].worknature);for(var a in e)if(e.hasOwnProperty(a)){for(var d=!1,f=0;f<t.form.overtimes.length;f++){var m=t.form.overtimes[f].pen;if(m==a){d=!0;break}}d||t.form.overtimes.push({pen:a,designation:e[a],from:r,to:o,worknature:s})}}),s)})}});